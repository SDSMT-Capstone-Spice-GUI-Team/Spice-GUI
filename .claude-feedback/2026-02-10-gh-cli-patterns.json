{
  "session": {
    "date": "2026-02-10",
    "session_type": "tooling-investigation",
    "model": "claude-opus-4-6",
    "description": "Investigation of gh CLI patterns for project board queries — what works, what doesn't, and recommended patterns for CLAUDE.md"
  },

  "problems_encountered": {
    "json_pipe_failure": {
      "description": "Piping `gh project item-list --format json` to `python3 -c` on Linux sometimes delivers empty stdin, causing JSONDecodeError",
      "workaround_used": "Write to temp file, then read with python3",
      "root_cause": "gh CLI and python3 pipe buffering race condition on Linux",
      "fix": "Use --jq flag instead of piping to python — processes JSON server-side in gh"
    },
    "limit_truncation": {
      "description": "Default --limit 30 silently truncates results. Board has 117+ items, so queries miss newly added items",
      "workaround_used": "Increased to --limit 200",
      "fix": "Always use --limit 200 for board queries (safe headroom for growth)"
    },
    "no_sort_or_filter_flags": {
      "description": "gh project item-list has no --sort, --order, or --filter flags. Items return in creation order (oldest first).",
      "workaround_used": "Fetch all items, filter client-side",
      "fix": "Use --jq for client-side filtering (still requires fetching all, but avoids temp files)"
    },
    "null_status_on_add": {
      "description": "gh project item-add does not set a default status. Items appear with status=null, not 'Backlog'",
      "fix": "Always follow item-add with item-edit to set status"
    }
  },

  "recommended_patterns": {
    "board_query_by_status": {
      "description": "Get all items in a specific status column",
      "command": "gh project item-list 2 --owner SDSMT-Capstone-Spice-GUI-Team --format json --limit 200 --jq '.items[] | select(.status == \"Ready\") | {number: .content.number, id: .id, title: .content.title}'",
      "notes": "Status values: Backlog, Ready, In progress, In review, Blocked, Done. null = no status set."
    },
    "board_query_by_issue_numbers": {
      "description": "Get board item IDs for specific issue numbers",
      "command": "gh project item-list 2 --owner SDSMT-Capstone-Spice-GUI-Team --format json --limit 200 --jq '.items[] | select(.content.number >= 188 and .content.number <= 195) | {number: .content.number, id: .id, status: .status}'",
      "notes": "Useful after batch-adding issues to get their item IDs for status updates"
    },
    "board_query_unset_status": {
      "description": "Find all items with no status (newly added, need column assignment)",
      "command": "gh project item-list 2 --owner SDSMT-Capstone-Spice-GUI-Team --format json --limit 200 --jq '.items[] | select(.status == null or .status == \"\") | {number: .content.number, id: .id}'",
      "notes": "Run after batch item-add to find items that need status set"
    },
    "board_query_compact": {
      "description": "Compact overview of entire board (minimal fields for token efficiency)",
      "command": "gh project item-list 2 --owner SDSMT-Capstone-Spice-GUI-Team --format json --limit 200 --jq '.items[] | {n: .content.number, s: .status}'",
      "notes": "Use short field names to minimize token usage. Pipe to sort if needed."
    },
    "board_query_recent": {
      "description": "Get the N most recently added items",
      "command": "gh project item-list 2 --owner SDSMT-Capstone-Spice-GUI-Team --format json --limit 200 --jq '[.items[]] | .[-10:] | .[] | {number: .content.number, id: .id, status: .status}'",
      "notes": "Items are returned in creation order, so [-N:] grabs the most recent. Note: sort_by(.id) gives lexicographic order which roughly matches creation order but is not guaranteed."
    },
    "batch_status_update": {
      "description": "Set status for multiple items in a loop",
      "command": "for item_id in ID1 ID2 ID3; do gh project item-edit --project-id PVT_xxx --id \"$item_id\" --field-id PVTSSF_xxx --single-select-option-id OPTION_ID; done",
      "notes": "Get item IDs first using board_query_by_issue_numbers pattern"
    },
    "issue_view_compact": {
      "description": "View issue details without triggering Projects Classic deprecation errors",
      "command": "gh issue view <N> --repo SDSMT-Capstone-Spice-GUI-Team/Spice-GUI --json title,body,state,labels,comments",
      "notes": "Always use --json flag. Without it, gh tries to fetch Projects Classic data which is deprecated."
    },
    "pr_list_open": {
      "description": "List open PRs with CI status",
      "command": "gh pr list --repo SDSMT-Capstone-Spice-GUI-Team/Spice-GUI --json number,title,headRefName,mergeable,statusCheckRollup --jq '.[] | {n: .number, t: .title, m: .mergeable, ci: (.statusCheckRollup // [] | map(.conclusion) | unique)}'",
      "notes": "Compact output with CI status summary"
    }
  },

  "anti_patterns": {
    "piping_to_python": {
      "description": "gh ... --format json | python3 -c 'import json; ...'",
      "problem": "Broken pipe / empty stdin on Linux",
      "replacement": "Use --jq flag directly, or write to temp file if complex processing needed"
    },
    "default_limit": {
      "description": "Omitting --limit (defaults to 30)",
      "problem": "Silently drops items beyond the first 30",
      "replacement": "Always specify --limit 200"
    },
    "assuming_status_on_add": {
      "description": "Expecting item-add to place items in Backlog",
      "problem": "Items get null status, don't appear in any column view",
      "replacement": "Always item-edit after item-add to set status"
    }
  },

  "claude_md_updates_needed": [
    {
      "section": "GitHub Board (Project #2) > Board Commands",
      "change": "Replace all python-pipe patterns with --jq equivalents",
      "reason": "Eliminates broken-pipe failures and temp file workarounds"
    },
    {
      "section": "GitHub Board (Project #2) > Board Commands",
      "change": "Add --limit 200 to all item-list commands",
      "reason": "Board has 117+ items, default 30 silently truncates"
    },
    {
      "section": "GitHub Board (Project #2) > Board Commands",
      "change": "Add note: item-add does not set status — must follow with item-edit",
      "reason": "Prevents items from being invisible in column views"
    },
    {
      "section": "New subsection: Board Query Patterns",
      "change": "Add the recommended_patterns from this file as copy-paste recipes",
      "reason": "Saves per-session discovery time and token usage"
    },
    {
      "section": "Autonomous Workflow > Work Loop",
      "change": "Step 2 should use --jq pattern: gh project item-list 2 --owner ... --format json --limit 200 --jq '.items[] | select(.status == \"Ready\") | {n: .content.number, id: .id, t: .content.title}'",
      "reason": "Compact, reliable, no temp files needed"
    }
  ],

  "token_efficiency_notes": {
    "compact_jq_fields": "Use short field aliases in --jq output: {n: .content.number, s: .status, id: .id} instead of full names",
    "filter_before_output": "--jq filters run inside gh before output, so only matching results consume tokens",
    "avoid_body_field": "Never include .content.body in board queries — issue bodies are huge. Use gh issue view for individual issue details.",
    "limit_vs_jq": "--limit caps the API fetch count. --jq filters the output. Both should be used: --limit 200 ensures all items are fetched, --jq ensures only relevant ones are returned."
  }
}
